<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>InfinityCloud</title>
<link rel="shortcut icon" href="./nuvem.png" type="image/x-icon">
<style>
:root {
  --bg: #0f1724;
  --card: #1e293b;
  --text: #fff;
  --accent: #6ee7b7;
}
body {
  background: var(--bg);
  color: var(--text);
  font-family: Arial, sans-serif;
  text-align: center;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 700px;
  margin: 50px auto;
  background: var(--card);
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 0 20px #0005;
}
input, textarea, button {
  width: 90%;
  margin: 8px 0;
  padding: 10px;
  border: none;
  border-radius: 8px;
}
textarea { height: 150px; resize: none; }
button {
  background: var(--accent);
  color: #000;
  font-weight: bold;
  cursor: pointer;
}
button:hover { opacity: 0.8; }
.site-card {
  background: #0b1220;
  margin: 8px 0;
  padding: 10px;
  border-radius: 8px;
}
.site-card a { color: var(--accent); text-decoration: none; font-weight: bold; }
</style>
</head>
<body>
  <div class="container">
    <h1>üåê InfinityCloud</h1>

    <input type="text" id="siteName" placeholder="Nome do site (sem espa√ßos)">
    <textarea id="siteHtml" placeholder="Cole seu c√≥digo HTML aqui"></textarea>
    <label><input type="checkbox" id="publishCommunity"> Publicar na comunidade</label><br>
    <button onclick="createSite()">Publicar</button>

    <h2>üß± Meus Sites</h2>
    <div id="mySites">Carregando...</div>

    <h2>üåç Comunidade</h2>
    <div id="communityList">Carregando...</div>
  </div>

<script>
const userId = localStorage.getItem("userId") || crypto.randomUUID();
localStorage.setItem("userId", userId);

async function loadMySites() {
  const res = await fetch("/api/mysites/" + userId);
  const sites = await res.json();
  const div = document.getElementById("mySites");
  div.innerHTML = "";
  if (!sites.length) return div.innerHTML = "<p>Voc√™ ainda n√£o criou sites.</p>";
  sites.forEach(site => {
    const el = document.createElement("div");
    el.className = "site-card";
    el.innerHTML = `
      <a href="/${site.name}" target="_blank">${site.name}</a><br>
      <button onclick="editSite('${site.name}')">‚úèÔ∏è Editar</button>
      <button onclick="deleteSite('${site.name}')">üóëÔ∏è Deletar</button>
    `;
    div.appendChild(el);
  });
}

async function loadCommunity() {
  const res = await fetch("/api/community");
  const sites = await res.json();
  const div = document.getElementById("communityList");
  div.innerHTML = "";
  if (!sites.length) return div.innerHTML = "<p>Nenhum site publicado ainda.</p>";
  sites.forEach(site => {
    const el = document.createElement("div");
    el.className = "site-card";
    el.innerHTML = `<a href="/${site.name}" target="_blank">${site.name}</a>`;
    div.appendChild(el);
  });
}

async function createSite() {
  const name = document.getElementById("siteName").value.trim();
  const html = document.getElementById("siteHtml").value;
  const publishCommunity = document.getElementById("publishCommunity").checked;
  if (!name || !html) return alert("‚ùå Preencha todos os campos!");
  const res = await fetch("/api/create", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, html, userId, publishCommunity })
  });
  const data = await res.json();
  if (!res.ok) return alert(data.error);
  alert(data.message);
  loadMySites();
  loadCommunity();
}

async function editSite(name) {
  const html = prompt("Cole o novo c√≥digo HTML:");
  if (!html) return;
  const res = await fetch("/api/edit", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, html, userId })
  });
  const data = await res.json();
  if (!res.ok) return alert(data.error);
  alert(data.message);
}

async function deleteSite(name) {
  if (!confirm("Tem certeza que deseja deletar " + name + "?")) return;
  const res = await fetch("/api/delete", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, userId })
  });
  const data = await res.json();
  if (!res.ok) return alert(data.error);
  alert(data.message);
  loadMySites();
  loadCommunity();
}

loadMySites();
loadCommunity();
</script>
</body>
</html>