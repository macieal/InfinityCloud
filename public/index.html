<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>InfinityCloud ‚òÅÔ∏è</title>
<style>
:root {
  --bg: #0f1724;
  --card: #1e293b;
  --text: #fff;
  --accent: #6ee7b7;
}
body {
  background: var(--bg);
  color: var(--text);
  font-family: Arial, sans-serif;
  text-align: center;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 700px;
  margin: 50px auto;
  background: var(--card);
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 0 20px #0005;
}
input, textarea, button {
  width: 90%;
  margin: 8px 0;
  padding: 10px;
  border: none;
  border-radius: 8px;
}
textarea {
  height: 150px;
  resize: none;
}
button {
  background: var(--accent);
  color: #000;
  font-weight: bold;
  cursor: pointer;
}
button:hover { opacity: 0.8; }
#communityList a {
  display: block;
  text-decoration: none;
  color: var(--text);
  background: #0b1220;
  margin: 6px 0;
  padding: 10px;
  border-radius: 8px;
  transition: 0.2s;
}
#communityList a:hover {
  background: var(--accent);
  color: #000;
}
</style>
</head>
<body>
  <div class="container">
    <h1>üåê InfinityCloud</h1>
    <p>Hospede seus sites e compartilhe com a comunidade!</p>

    <input type="text" id="siteName" placeholder="Nome do site (sem espa√ßos)">
    <textarea id="siteHtml" placeholder="Cole seu c√≥digo HTML aqui"></textarea>
    <label>
      <input type="checkbox" id="publishCommunity">
      Publicar na comunidade
    </label><br>
    <button onclick="createSite()">Publicar site</button>

    <h2>üåç Comunidade</h2>
    <div id="communityList">Carregando sites...</div>
  </div>

<script>
const userId = localStorage.getItem("userId") || crypto.randomUUID();
localStorage.setItem("userId", userId);

async function loadCommunity() {
  const res = await fetch("/api/community");
  const sites = await res.json();
  const list = document.getElementById("communityList");
  list.innerHTML = "";
  if (!sites.length) {
    list.innerHTML = "<p>Nenhum site publicado ainda!</p>";
    return;
  }
  sites.forEach(name => {
    const a = document.createElement("a");
    a.href = "/" + name;
    a.textContent = name;
    list.appendChild(a);
  });
}
loadCommunity();

async function createSite() {
  const name = document.getElementById("siteName").value.trim();
  const html = document.getElementById("siteHtml").value;
  const publishCommunity = document.getElementById("publishCommunity").checked;
  if (!name) return alert("‚ùå D√™ um nome ao seu site!");
  if (!html) return alert("‚ùå Cole o HTML do seu site!");

  try {
    const res = await fetch("/api/create", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, html, userId, publishCommunity })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || "Erro desconhecido");
    alert(data.message);
    loadCommunity();
  } catch (err) {
    alert(err.message);
  }
}
</script>
</body>
</html>
