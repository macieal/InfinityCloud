<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InfinityCloud</title>
  <link rel="shortcut icon" href="./nuvem.png" type="image/x-icon">
  <style>
    :root {
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa7b2;
      --accent:#6ee7b7;
    }

    * {
      box-sizing:border-box;
      font-family:Inter, system-ui, Arial, sans-serif;
    }

    body {
      margin:0;
      background:var(--bg);
      color:white;
    }

    header {
      background:var(--card);
      padding:1rem 2rem;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    h1 {
      margin:0;
      font-size:1.5rem;
    }

    .controls button {
      background:var(--accent);
      border:none;
      padding:8px 15px;
      border-radius:8px;
      cursor:pointer;
      font-weight:bold;
    }

    main {
      padding:1rem 2rem;
      max-width:800px;
      margin:auto;
    }

    .site {
      background:var(--card);
      padding:1rem;
      border-radius:8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:1rem;
    }

    .site a {
      color:var(--accent);
      text-decoration:none;
    }

    .site button {
      background:red;
      border:none;
      padding:5px 10px;
      border-radius:6px;
      cursor:pointer;
      color:white;
    }

    dialog {
      background:var(--card);
      color:white;
      border:none;
      border-radius:10px;
      padding:1rem;
      width:350px;
    }

    dialog::backdrop {
      background:rgba(0,0,0,0.5);
    }

    input, textarea {
      width:100%;
      margin-top:10px;
      padding:10px;
      border-radius:8px;
      border:1px solid var(--muted);
      background:#08111e;
      color:white;
      font-size:14px;
    }

    textarea {
      min-height:100px;
    }

    .modal-buttons {
      display:flex;
      justify-content:flex-end;
      margin-top:10px;
      gap:10px;
    }

    .modal-buttons button {
      background:var(--accent);
      border:none;
      padding:8px 15px;
      border-radius:8px;
      cursor:pointer;
      font-weight:bold;
      color:black;
    }

    .modal-buttons .cancel {
      background:#444;
      color:white;
    }

  </style>
</head>
<body>
  <header>
    <h1>☁ InfinityCloud</h1>
    <div class="controls">
      <button id="newSiteBtn">+ Novo site</button>
    </div>
  </header>

  <main id="siteList"></main>

  <dialog id="modal">
    <h2>Criar novo site</h2>
    <input type="text" id="siteName" placeholder="Nome do site">
    <textarea id="siteHTML" placeholder="Cole o HTML aqui"></textarea>
    <div class="modal-buttons">
      <button class="cancel" id="cancelBtn">Cancelar</button>
      <button id="createBtn">Criar</button>
    </div>
  </dialog>

  <script>
    const modal = document.getElementById("modal");
    const newSiteBtn = document.getElementById("newSiteBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const createBtn = document.getElementById("createBtn");
    const siteList = document.getElementById("siteList");

    async function createSite() {
      const name = document.getElementById("siteName").value.trim();
      const html = document.getElementById("siteHTML").value.trim();
      if (!name || !html) {
        alert("Preencha o nome e o HTML!");
        return;
      }

      const res = await fetch("/api/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, html })
      });

      if (res.ok) {
        alert("✅ Site criado com sucesso!");
        document.getElementById("siteName").value = "";
        document.getElementById("siteHTML").value = "";
        modal.close();
        loadSites();
      } else {
        alert("❌ Erro ao criar site!");
      }
    }

    async function loadSites() {
      const res = await fetch("/api/list");
      const sites = await res.json();
      siteList.innerHTML = "";
      sites.forEach(site => {
        const div = document.createElement("div");
        div.className = "site";
        div.innerHTML = `
          <a href="/${site}" target="_blank">${site}</a>
          <button onclick="deleteSite('${site}')">Excluir</button>
        `;
        siteList.appendChild(div);
      });
    }

    async function deleteSite(name) {
      if (!confirm(`Tem certeza que quer excluir "${name}"?`)) return;
      await fetch(`/api/delete/${name}`, { method: "DELETE" });
      loadSites();
    }

    newSiteBtn.onclick = () => modal.showModal();
    cancelBtn.onclick = () => modal.close();
    createBtn.onclick = createSite;

    loadSites();
  </script>
</body>
</html>